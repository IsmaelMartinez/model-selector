<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model Comparison: DistilBERT vs BART MNLI</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .loading { background: #e3f2fd; border: 1px solid #2196f3; }
        .success { background: #e8f5e8; border: 1px solid #4caf50; }
        .error { background: #ffebee; border: 1px solid #f44336; }
        .warning { background: #fff3e0; border: 1px solid #ff9800; }
        .result { margin: 10px 0; padding: 15px; background: #f5f5f5; border-radius: 4px; }
        .comparison-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .model-section { border: 1px solid #ddd; padding: 15px; border-radius: 4px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { padding: 8px; text-align: left; border: 1px solid #ddd; }
        th { background-color: #f2f2f2; }
        .metric { display: inline-block; margin: 10px; padding: 10px; background: white; border-radius: 4px; border: 1px solid #ddd; }
        .winner { background: #e8f5e8; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üèÜ Model Comparison: DistilBERT vs BART MNLI</h1>
    
    <div id="status" class="status loading">
        Loading evaluation frameworks...
    </div>
    
    <div id="controls">
        <button id="loadModels" onclick="loadBothModels()">1. Load Both Models</button>
        <button id="runComparison" onclick="runComparison()" disabled>2. Run Performance Comparison</button>
        <button id="runAccuracy" onclick="runAccuracyComparison()" disabled>3. Compare Accuracy</button>
        <button id="runFullComparison" onclick="runFullComparison()" disabled>4. Full Side-by-Side Comparison</button>
    </div>
    
    <div id="results"></div>
    
    <script type="module">
        import { DistilBERTMNLIEvaluator } from './distilbert-mnli-evaluation.js';
        import { BARTMNLIEvaluator } from './bart-mnli-evaluation.js';
        
        let distilbertEvaluator, bartEvaluator;
        let distilbertLoaded = false, bartLoaded = false;
        
        window.addEventListener('load', async () => {
            try {
                distilbertEvaluator = new DistilBERTMNLIEvaluator();
                bartEvaluator = new BARTMNLIEvaluator();
                document.getElementById('status').innerHTML = '‚úÖ Evaluation frameworks ready';
                document.getElementById('status').className = 'status success';
            } catch (error) {
                document.getElementById('status').innerHTML = `‚ùå Error: ${error.message}`;
                document.getElementById('status').className = 'status error';
            }
        });
        
        window.loadBothModels = async function() {
            const button = document.getElementById('loadModels');
            const status = document.getElementById('status');
            
            button.disabled = true;
            button.textContent = 'Loading Models...';
            status.innerHTML = 'üîÑ Loading both models (this may take a while)...';
            status.className = 'status loading';
            
            try {
                // Load DistilBERT first (smaller model)
                status.innerHTML = 'üîÑ Loading DistilBERT MNLI...';
                const distilbertResult = await distilbertEvaluator.loadModel();
                
                if (distilbertResult.success) {
                    distilbertLoaded = true;
                    status.innerHTML = `‚úÖ DistilBERT loaded (${distilbertResult.loadTime.toFixed(2)}ms). Loading BART...`;
                    
                    // Load BART (larger model)
                    const bartResult = await bartEvaluator.loadModel();
                    
                    if (bartResult.success) {
                        bartLoaded = true;
                        status.innerHTML = `‚úÖ Both models loaded! DistilBERT: ${distilbertResult.loadTime.toFixed(2)}ms, BART: ${bartResult.loadTime.toFixed(2)}ms`;
                        status.className = 'status success';
                        
                        // Enable comparison buttons
                        document.getElementById('runComparison').disabled = false;
                        document.getElementById('runAccuracy').disabled = false;
                        document.getElementById('runFullComparison').disabled = false;
                    } else {
                        status.innerHTML = `‚ö†Ô∏è DistilBERT loaded, but BART failed: ${bartResult.error}`;
                        status.className = 'status warning';
                    }
                } else {
                    status.innerHTML = `‚ùå Failed to load DistilBERT: ${distilbertResult.error}`;
                    status.className = 'status error';
                }
            } catch (error) {
                status.innerHTML = `‚ùå Error loading models: ${error.message}`;
                status.className = 'status error';
            }
            
            button.disabled = false;
            button.textContent = '1. Load Both Models';
        };
        
        window.runComparison = async function() {
            const button = document.getElementById('runComparison');
            const resultsDiv = document.getElementById('results');
            
            button.disabled = true;
            button.textContent = 'Running Performance Comparison...';
            
            try {
                const [distilbertResults, bartResults] = await Promise.all([
                    distilbertEvaluator.runPerformanceBenchmark(),
                    bartEvaluator.runPerformanceBenchmark()
                ]);
                
                resultsDiv.innerHTML = `
                    <div class="result">
                        <h3>‚ö° Performance Comparison</h3>
                        
                        <div class="comparison-grid">
                            <div class="model-section">
                                <h4>DistilBERT MNLI</h4>
                                <div class="metric">Load Time: ${distilbertResults.modelLoadResult.loadTime.toFixed(2)}ms</div>
                                <div class="metric">Avg Inference: ${distilbertResults.averageInferenceTime.toFixed(2)}ms</div>
                                <div class="metric">Model Size: ${distilbertResults.modelSize}</div>
                                <div class="metric">Memory: ${distilbertResults.memoryUsage}</div>
                            </div>
                            
                            <div class="model-section">
                                <h4>BART MNLI</h4>
                                <div class="metric">Load Time: ${bartResults.modelLoadResult.loadTime.toFixed(2)}ms</div>
                                <div class="metric">Avg Inference: ${bartResults.averageInferenceTime.toFixed(2)}ms</div>
                                <div class="metric">Model Size: ${bartResults.modelSize}</div>
                                <div class="metric">Memory: ${bartResults.memoryUsage}</div>
                            </div>
                        </div>
                        
                        <h4>üèÜ Performance Winners:</h4>
                        <div class="metric ${distilbertResults.modelLoadResult.loadTime < bartResults.modelLoadResult.loadTime ? 'winner' : ''}">
                            Faster Load: ${distilbertResults.modelLoadResult.loadTime < bartResults.modelLoadResult.loadTime ? 'DistilBERT' : 'BART'}
                        </div>
                        <div class="metric ${distilbertResults.averageInferenceTime < bartResults.averageInferenceTime ? 'winner' : ''}">
                            Faster Inference: ${distilbertResults.averageInferenceTime < bartResults.averageInferenceTime ? 'DistilBERT' : 'BART'}
                        </div>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="result error">Error running comparison: ${error.message}</div>`;
            }
            
            button.disabled = false;
            button.textContent = '2. Run Performance Comparison';
        };
        
        window.runAccuracyComparison = async function() {
            const button = document.getElementById('runAccuracy');
            const resultsDiv = document.getElementById('results');
            
            button.disabled = true;
            button.textContent = 'Testing Accuracy...';
            
            try {
                const [distilbertAccuracy, bartAccuracy] = await Promise.all([
                    distilbertEvaluator.testAccuracyWithExpectedResults(),
                    bartEvaluator.testAccuracyWithExpectedResults()
                ]);
                
                resultsDiv.innerHTML = `
                    <div class="result">
                        <h3>üéØ Accuracy Comparison</h3>
                        
                        <div class="comparison-grid">
                            <div class="model-section ${distilbertAccuracy.accuracy >= bartAccuracy.accuracy ? 'winner' : ''}">
                                <h4>DistilBERT MNLI</h4>
                                <div class="metric">Accuracy: ${distilbertAccuracy.accuracy.toFixed(1)}%</div>
                                <div class="metric">Correct: ${distilbertAccuracy.correct}/${distilbertAccuracy.total}</div>
                            </div>
                            
                            <div class="model-section ${bartAccuracy.accuracy > distilbertAccuracy.accuracy ? 'winner' : ''}">
                                <h4>BART MNLI</h4>
                                <div class="metric">Accuracy: ${bartAccuracy.accuracy.toFixed(1)}%</div>
                                <div class="metric">Correct: ${bartAccuracy.correct}/${bartAccuracy.total}</div>
                            </div>
                        </div>
                        
                        <h4>üìä Detailed Accuracy Results:</h4>
                        <table>
                            <tr>
                                <th>Test Case</th>
                                <th>Expected</th>
                                <th>DistilBERT</th>
                                <th>BART</th>
                                <th>Agreement</th>
                            </tr>
                            ${distilbertAccuracy.results.map((result, i) => `
                                <tr>
                                    <td>${result.input}</td>
                                    <td>${result.expected}</td>
                                    <td style="background: ${result.correct ? '#e8f5e8' : '#ffebee'}">${result.predicted} (${(result.confidence * 100).toFixed(1)}%)</td>
                                    <td style="background: ${bartAccuracy.results[i].correct ? '#e8f5e8' : '#ffebee'}">${bartAccuracy.results[i].predicted} (${(bartAccuracy.results[i].confidence * 100).toFixed(1)}%)</td>
                                    <td>${result.predicted === bartAccuracy.results[i].predicted ? '‚úÖ' : '‚ùå'}</td>
                                </tr>
                            `).join('')}
                        </table>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="result error">Error testing accuracy: ${error.message}</div>`;
            }
            
            button.disabled = false;
            button.textContent = '3. Compare Accuracy';
        };
        
        window.runFullComparison = async function() {
            const button = document.getElementById('runFullComparison');
            
            button.disabled = true;
            button.textContent = 'Running Full Comparison...';
            
            try {
                const comparison = await bartEvaluator.compareWithDistilBERT(distilbertEvaluator);
                
                document.getElementById('results').innerHTML = `
                    <div class="result">
                        <h3>üî¨ Full Side-by-Side Comparison</h3>
                        
                        <div class="metric">
                            <strong>Model Agreement Rate:</strong> ${(comparison.summary.agreementRate * 100).toFixed(1)}%
                        </div>
                        
                        <div class="metric">
                            <strong>Average Inference Time:</strong> 
                            DistilBERT: ${comparison.summary.distilbert.avgInferenceTime.toFixed(2)}ms, 
                            BART: ${comparison.summary.bart.avgInferenceTime.toFixed(2)}ms
                        </div>
                        
                        <h4>üÜö Head-to-Head Results:</h4>
                        <table>
                            <tr>
                                <th>Input</th>
                                <th>DistilBERT Prediction</th>
                                <th>BART Prediction</th>
                                <th>Confidence Diff</th>
                                <th>Speed Diff</th>
                            </tr>
                            ${comparison.testCases.map(tc => `
                                <tr style="background: ${tc.agreement ? '#e8f5e8' : '#fff3e0'}">
                                    <td>${tc.input}</td>
                                    <td>${tc.distilbert.prediction} (${(tc.distilbert.confidence * 100).toFixed(1)}%)</td>
                                    <td>${tc.bart.prediction} (${(tc.bart.confidence * 100).toFixed(1)}%)</td>
                                    <td>${((tc.bart.confidence - tc.distilbert.confidence) * 100).toFixed(1)}%</td>
                                    <td>${(tc.bart.inferenceTime - tc.distilbert.inferenceTime).toFixed(0)}ms</td>
                                </tr>
                            `).join('')}
                        </table>
                        
                        <h4>üìà Recommendation:</h4>
                        <div class="metric" style="font-size: 16px; background: #e3f2fd;">
                            ${comparison.summary.distilbert.avgInferenceTime < comparison.summary.bart.avgInferenceTime 
                                ? '‚ö° <strong>DistilBERT</strong> is faster and more suitable for real-time applications'
                                : 'üéØ <strong>BART</strong> provides better accuracy but slower inference'}
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('results').innerHTML = `<div class="result error">Error running full comparison: ${error.message}</div>`;
            }
            
            button.disabled = false;
            button.textContent = '4. Full Side-by-Side Comparison';
        };
    </script>
</body>
</html>