<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Taxonomy Classification Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 40px; 
            background: #f8f9fa;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status { 
            padding: 15px; 
            margin: 15px 0; 
            border-radius: 6px; 
            font-weight: 500;
        }
        .loading { background: #e3f2fd; border: 1px solid #2196f3; color: #1976d2; }
        .success { background: #e8f5e8; border: 1px solid #4caf50; color: #2e7d32; }
        .error { background: #ffebee; border: 1px solid #f44336; color: #c62828; }
        .warning { background: #fff3e0; border: 1px solid #ff9800; color: #ef6c00; }
        
        .taxonomy-info {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 6px;
            margin: 20px 0;
        }
        
        .categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .category-badge {
            background: #e3f2fd;
            padding: 8px 12px;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
            border: 1px solid #2196f3;
        }
        
        .results { 
            margin: 20px 0; 
            padding: 20px; 
            background: #f8f9fa; 
            border-radius: 6px; 
        }
        
        .model-results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .model-card {
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 6px;
            background: white;
        }
        
        .model-card.winner {
            border-color: #4caf50;
            background: #f1f8e9;
        }
        
        button { 
            padding: 12px 24px; 
            margin: 8px; 
            cursor: pointer; 
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        button:disabled { 
            opacity: 0.6; 
            cursor: not-allowed; 
        }
        
        .btn-primary {
            background: #2196f3;
            color: white;
        }
        
        .btn-success {
            background: #4caf50;
            color: white;
        }
        
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 15px 0; 
            font-size: 14px;
        }
        
        th, td { 
            padding: 10px; 
            text-align: left; 
            border: 1px solid #ddd; 
        }
        
        th { 
            background-color: #f2f2f2; 
            font-weight: 600;
        }
        
        .metric { 
            display: inline-block; 
            margin: 8px; 
            padding: 12px 16px; 
            background: white; 
            border-radius: 4px; 
            border: 1px solid #ddd;
            font-size: 14px;
        }
        
        .metric.highlight { 
            background: #e8f5e8; 
            border-color: #4caf50;
            font-weight: 600;
        }
        
        .accuracy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .category-accuracy {
            background: white;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #4caf50;
            transition: width 0.3s ease;
        }
        
        .test-case {
            background: white;
            margin: 8px 0;
            padding: 12px;
            border-radius: 4px;
            border-left: 4px solid #ddd;
        }
        
        .test-case.correct { border-left-color: #4caf50; }
        .test-case.incorrect { border-left-color: #f44336; }
        
        .confidence-high { color: #2e7d32; font-weight: 600; }
        .confidence-medium { color: #ef6c00; font-weight: 500; }
        .confidence-low { color: #c62828; font-weight: 500; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Task Taxonomy Classification Test</h1>
        <p>Testing zero-shot classification accuracy with our 7-category task taxonomy</p>
        
        <div class="taxonomy-info">
            <h3>üìã Task Taxonomy Overview</h3>
            <div id="taxonomyInfo">Loading taxonomy information...</div>
        </div>
        
        <div id="status" class="status loading">
            Initializing taxonomy classification tester...
        </div>
        
        <div id="controls">
            <button id="runFullTest" class="btn-primary" onclick="runFullTaxonomyTest()">üöÄ Run Full Taxonomy Test</button>
            <button id="runDistilBERTOnly" class="btn-success" onclick="runDistilBERTTest()" disabled>‚ö° Test DistilBERT Only</button>
            <button id="showTestCases" onclick="showTestCases()" disabled>üìù Show Test Cases</button>
        </div>
        
        <div id="results"></div>
    </div>
    
    <script type="module">
        import { TaxonomyClassificationTester } from './taxonomy-classification-test.js';
        
        let tester;
        
        window.addEventListener('load', async () => {
            try {
                tester = new TaxonomyClassificationTester();
                
                // Display taxonomy info
                const taxonomyInfo = document.getElementById('taxonomyInfo');
                taxonomyInfo.innerHTML = `
                    <p><strong>Total Categories:</strong> ${tester.taskCategories.length}</p>
                    <p><strong>Total Test Cases:</strong> ${tester.taxonomyTestCases.length}</p>
                    <div class="categories">
                        ${tester.taskCategories.map(cat => `<div class="category-badge">${cat}</div>`).join('')}
                    </div>
                `;
                
                document.getElementById('status').innerHTML = '‚úÖ Taxonomy tester ready';
                document.getElementById('status').className = 'status success';
                
                // Enable buttons
                document.getElementById('runDistilBERTOnly').disabled = false;
                document.getElementById('showTestCases').disabled = false;
                
            } catch (error) {
                document.getElementById('status').innerHTML = `‚ùå Error: ${error.message}`;
                document.getElementById('status').className = 'status error';
            }
        });
        
        window.runFullTaxonomyTest = async function() {
            const button = document.getElementById('runFullTest');
            const status = document.getElementById('status');
            const resultsDiv = document.getElementById('results');
            
            button.disabled = true;
            button.textContent = 'üîÑ Running Full Test...';
            status.innerHTML = 'üîÑ Running comprehensive taxonomy classification test...';
            status.className = 'status loading';
            
            try {
                const results = await tester.runFullTaxonomyTest();
                
                status.innerHTML = '‚úÖ Taxonomy test completed successfully';
                status.className = 'status success';
                
                resultsDiv.innerHTML = generateFullTestResults(results);
                
            } catch (error) {
                status.innerHTML = `‚ùå Test failed: ${error.message}`;
                status.className = 'status error';
                resultsDiv.innerHTML = `<div class="results error">Error: ${error.message}</div>`;
            }
            
            button.disabled = false;
            button.textContent = 'üöÄ Run Full Taxonomy Test';
        };
        
        window.runDistilBERTTest = async function() {
            const button = document.getElementById('runDistilBERTOnly');
            const status = document.getElementById('status');
            const resultsDiv = document.getElementById('results');
            
            button.disabled = true;
            button.textContent = '‚ö° Testing DistilBERT...';
            status.innerHTML = 'üîÑ Testing DistilBERT with taxonomy...';
            status.className = 'status loading';
            
            try {
                await tester.distilbertEvaluator.loadModel();
                const results = await tester.testModelWithTaxonomy(tester.distilbertEvaluator, 'DistilBERT MNLI');
                
                status.innerHTML = '‚úÖ DistilBERT test completed';
                status.className = 'status success';
                
                resultsDiv.innerHTML = generateSingleModelResults(results);
                
            } catch (error) {
                status.innerHTML = `‚ùå DistilBERT test failed: ${error.message}`;
                status.className = 'status error';
                resultsDiv.innerHTML = `<div class="results error">Error: ${error.message}</div>`;
            }
            
            button.disabled = false;
            button.textContent = '‚ö° Test DistilBERT Only';
        };
        
        window.showTestCases = function() {
            const resultsDiv = document.getElementById('results');
            
            resultsDiv.innerHTML = `
                <div class="results">
                    <h3>üìù Taxonomy Test Cases</h3>
                    <p>Total test cases: ${tester.taxonomyTestCases.length}</p>
                    
                    ${tester.taskCategories.map(category => {
                        const categoryCases = tester.taxonomyTestCases.filter(tc => tc.expected === category);
                        return `
                            <div class="category-accuracy">
                                <h4>${category} (${categoryCases.length} cases)</h4>
                                ${categoryCases.map(tc => `
                                    <div class="test-case">
                                        <strong>Input:</strong> "${tc.input}"<br>
                                        <strong>Expected:</strong> ${tc.expected}<br>
                                        <strong>Subcategory:</strong> ${tc.subcategory}
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        };
        
        function generateFullTestResults(results) {
            let html = `
                <div class="results">
                    <h3>üèÜ Comprehensive Taxonomy Test Results</h3>
                    
                    <div class="model-results">
                        <div class="model-card ${results.comparison?.accuracyWinner === 'DistilBERT' ? 'winner' : ''}">
                            <h4>DistilBERT MNLI</h4>
                            ${generateModelMetrics(results.distilbertResults)}
                        </div>
            `;
            
            if (results.bartResults) {
                html += `
                        <div class="model-card ${results.comparison?.accuracyWinner === 'BART' ? 'winner' : ''}">
                            <h4>BART MNLI</h4>
                            ${generateModelMetrics(results.bartResults)}
                        </div>
                `;
            }
            
            html += '</div>';
            
            if (results.comparison) {
                html += `
                    <div class="results">
                        <h3>üÜö Model Comparison</h3>
                        <div class="metric highlight">Overall Winner (Accuracy): ${results.comparison.accuracyWinner}</div>
                        <div class="metric highlight">Speed Winner: ${results.comparison.speedWinner}</div>
                        <div class="metric">${results.comparison.overallRecommendation}</div>
                        
                        <h4>üìä Category-wise Winners:</h4>
                        <div class="accuracy-grid">
                            ${Object.entries(results.comparison.categoryWinners).map(([category, winner]) => `
                                <div class="category-accuracy">
                                    <strong>${category}:</strong> ${winner}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            html += generateDetailedResults(results.distilbertResults, 'DistilBERT');
            
            if (results.bartResults) {
                html += generateDetailedResults(results.bartResults, 'BART');
            }
            
            html += '</div>';
            return html;
        }
        
        function generateSingleModelResults(results) {
            return `
                <div class="results">
                    <h3>üìä ${results.modelName} Taxonomy Test Results</h3>
                    ${generateModelMetrics(results)}
                    ${generateDetailedResults(results, results.modelName)}
                </div>
            `;
        }
        
        function generateModelMetrics(results) {
            return `
                <div class="metric highlight">Overall Accuracy: ${results.overallAccuracy.toFixed(1)}%</div>
                <div class="metric">Average Inference: ${results.averageInferenceTime.toFixed(2)}ms</div>
                <div class="metric">High Confidence: ${results.confidenceDistribution.high}</div>
                <div class="metric">Medium Confidence: ${results.confidenceDistribution.medium}</div>
                <div class="metric">Low Confidence: ${results.confidenceDistribution.low}</div>
                
                <h4>üìà Per-Category Accuracy:</h4>
                <div class="accuracy-grid">
                    ${Object.entries(results.categoryAccuracy).map(([category, data]) => `
                        <div class="category-accuracy">
                            <strong>${category}</strong><br>
                            ${data.correct}/${data.total} (${data.accuracy.toFixed(1)}%)
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${data.accuracy}%"></div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function generateDetailedResults(results, modelName) {
            return `
                <div class="results">
                    <h3>üîç ${modelName} Detailed Results</h3>
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${results.detailedResults.map(result => `
                            <div class="test-case ${result.correct ? 'correct' : 'incorrect'}">
                                <div><strong>Input:</strong> "${result.input}"</div>
                                <div><strong>Expected:</strong> ${result.expected} | <strong>Predicted:</strong> ${result.predicted}</div>
                                <div>
                                    <strong>Confidence:</strong> 
                                    <span class="confidence-${result.confidence >= 0.8 ? 'high' : result.confidence >= 0.6 ? 'medium' : 'low'}">
                                        ${(result.confidence * 100).toFixed(1)}%
                                    </span>
                                    | <strong>Time:</strong> ${result.inferenceTime.toFixed(0)}ms
                                    | <strong>Result:</strong> ${result.correct ? '‚úÖ' : '‚ùå'}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>